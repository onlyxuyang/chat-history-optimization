# Chat History Optimization Extension for SillyTavern

本扩展用于优化 SillyTavern 的聊天历史，减少长对话时的字符/Token消耗，并支持灵活的正则表达式摘要与正文提取。

---

## 功能亮点

- **自定义正则摘要与正文提取**  
  支持多行正则表达式，灵活控制哪些内容保留、哪些内容移除。
- **节省字符统计**  
  实时显示已节省的字符数。
- **预览功能**  
  可一键展开预览“摘要”或“正文”处理效果。
- **可视化设置界面**  
  所有设置均可在 SillyTavern 扩展设置页中直观操作。

---

## 使用说明

> **界面说明：**
> - **启用功能**：一键开关本扩展。
> - **正文深度**：控制保留多少条完整正文，其余用摘要。
> - **摘要内容/正文内容**：多行正则表达式，`+` 开头为保留，`-` 开头为移除。
> - **字符统计**：显示累计节省的字符数。
> - **摘要预览/正文预览**：点击可展开，实时查看正则处理效果。

---

## 正则表达式规则

- 每行一个正则表达式。
- 以 `+` 开头：匹配后保留，所有匹配内容用空行拼接。
- 以 `-` 开头：在所有 `+` 处理后，移除匹配到的内容。
- 支持标准 JS 正则语法（无需 `/` 包裹）。

**示例：**
```regex
+<details>((?:(?!<details>)[\s\S])*?)</details>
-[\s\S]*?<\/think.*>
```
